# tdf-animation-sequence

Demonstration of a sequence of custom mapboxgl camera and layer animations to display a Tour de France stage

## Background

In the summer of 2022, Mapbox did a social media campaign to support Strava's sponsorship of the Tour de France.  Each day we shared a video of an animated map showing that day's stage of the tour.

The videos were generated by @moritzzzzz, with [code here](https://github.com/mapbox/emea-sales-pod/tree/main/stravaTourDeFrance) that outputs the videos for use in social media posts.

This is an adaptation of the orginal code, refactored to be more amenable to talking through in a how-to video.  The video output is excluded, code for the two complex camera animations is moved out of the main script into `fly-in-and-rotate.js` and `animate-path.js`

## Techniques Demonstrated

- Using `getAnimationFrame()` with the [FreeCamera API](https://docs.mapbox.com/mapbox-gl-js/api/properties/#freecameraoptions) to transition the altitude and bearing while staying aimed at a specific point over a duration

- Using `line-progress` in an expression to animate "drawing" a linestring over a duration period

- Using `getAnimationFrame()` with the [FreeCamera API](https://docs.mapbox.com/mapbox-gl-js/api/properties/#freecameraoptions) to transition the camera's aim to follow the leading edge of an animated linestring over a duration

- Using async/await for flow control of camera animations in a sequence

- Video download is not included, but the approach in this [video export example](https://github.com/mapbox/mapbox-gl-js/blob/main/debug/video-export.html) can be used.

## How to Use

Load `index.html` using a local [live server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)

### Query Params
These query parameters were added to make it easier to develop and to quickly export different animations for the Tour de France Social Media Videos.

`gender` (male|female), `stage` (number) query params will determine which geojson file is loaded for animation, and what the downloaded filename will be

`prod` (boolean) will determine whether a download is triggered after the animation is complete, and will toggle between prod and dev durations for animations (prod animation durations are longer)

`square` (boolean) if true, sets the dimensions of the map container to 1080x1080

Example URL with query params: `http://127.0.0.1:5500/?gender=male&stage=1&prod=true&square=true`